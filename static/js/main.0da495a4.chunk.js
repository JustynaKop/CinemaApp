(this["webpackJsonpcinema-reservations"]=this["webpackJsonpcinema-reservations"]||[]).push([[0],{17:function(e,t,a){e.exports=a(45)},22:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(7),i=a.n(s),l=(a(22),a(1)),c=a(14),o=a(3),m=a(2),u=a(4),d=a(15),p=a.n(d),v=a(9),f=a.n(v),h=(a(13),a(38),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(m.a)(t).call(this,e))).filterAvailableHours=function(e){a.availableHours=a.state.movieData.displayDates.filter((function(t){return new Date(t.displayDateTime).toLocaleDateString("pl-PL")===e})).map((function(e){return{label:new Date(e.displayDateTime).toLocaleDateString("pl-PL",{hour:"numeric",minute:"numeric"}).split(",")[1],value:e.displayDateTime}})).sort((function(e){return e.value})),a.selectedDateTime=a.availableHours[0].value},a.onDateChanged=function(e){a.filterAvailableHours(e.value),a.setState({selectedDate:e.value})},a.onSelectedDateTimeChanged=function(e){a.selectedDateTime=e.value},a.onReserveClicked=function(e){console.log(a.selectedDateTime),a.props.onReserveClicked(a.selectedDateTime,a.state.movieData)},a.setMinHeight=function(e){a.setState({minHeight:e})},a.componentDidMount=function(){a.filterAvailableHours(a.state.selectedDate)},a.render=function(){return r.a.createElement("div",{style:{minHeight:a.state.minHeight+"px"},className:"movie-container",ref:a.ref},r.a.createElement("h1",{style:{color:"orange"}},a.state.movieData.movie.title),r.a.createElement("div",{className:"movie-data-container"},r.a.createElement("div",{className:"image-poster-container"},r.a.createElement("img",{className:"image-poster",src:a.state.movieData.movie.poster,alt:""})),r.a.createElement("div",{className:"movie-details-container"},r.a.createElement("div",null,r.a.createElement("h3",{className:"date-header"}," Display date"),r.a.createElement(f.a,{options:a.displayDates,onChange:a.onDateChanged,value:a.state.selectedDate,placholder:"Select date"})),r.a.createElement("div",null,r.a.createElement("h3",{className:"hour-header"},"Display hour"),r.a.createElement(f.a,{options:a.availableHours,onChange:a.onSelectedDateTimeChanged,value:a.availableHours[0],placholder:"Select hour"})),r.a.createElement("button",{className:"reservation-button",onClick:a.onReserveClicked},"Make reservation"),r.a.createElement("div",null,r.a.createElement("h3",null,"Director"),r.a.createElement("span",{className:"movie-details-text"},a.state.movieData.movie.director)),r.a.createElement("div",null,r.a.createElement("h3",null,"Actors"),r.a.createElement("span",{className:"movie-details-text"},a.state.movieData.movie.actors)))),r.a.createElement("div",null,r.a.createElement("h3",null,"Description"),r.a.createElement("p",{className:"movie-details-text"},a.state.movieData.movie.description)))},a.displayDates=e.movieData.displayDates.sort().map((function(e){return new Date(e.displayDateTime).toLocaleDateString("pl-PL")})).filter((function(e,t,a){return a.indexOf(e)===t})),a.availableHours=[],a.selectedDateTime=void 0,a.state={movieData:e.movieData,selectedDate:a.displayDates[0],minHeight:a.props.minHeight||0},a.ref=r.a.createRef(),a}return Object(u.a)(t,e),t}(r.a.Component)),b=a(5),E=a(16);a(39);function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var g=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(m.a)(t).call(this,e))).onTicketValueChanged=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(a,!0).forEach((function(t){Object(E.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},a.state.selectedTickets);t[e.target.id]=e.target.value,a.setState({selectedTickets:t})},a.onNextClick=function(e){var t=Object.values(a.state.selectedTickets).reduce((function(e,t){return Number(e)+Number(t)}),0);console.log(t),t>20?a.setState({lastError:"Maksimum number of total 20 tickets is allowed. If you need more please contact with our group reservations section."}):0===t?a.setState({lastError:"To continue you need to specify at least one ticket."}):a.props.onTicketsSelected&&a.props.onTicketsSelected(Object(b.a)(a.state.tickets).map((function(e){return e.amount=a.state.selectedTickets[e._id]||0,e})))},a.componentDidMount=function(){fetch("https://cinnemapplication.herokuapp.com/ticket").then((function(e){return 200!==e.status?Promise.reject("Service is temporary unavailable."):e.json()})).then((function(e){if("sucess"!==e.status)return Promise.reject("Service is temporary unavailable.");if(null!==a.props.selectedTickets&&void 0!==a.props.selectedTickets)a.setState({tickets:e.ticketsData,selectedTickets:a.props.selectedTickets.reduce((function(e,t){return e[t._id]=t.amount,e}),{})});else{var t={};e.ticketsData.forEach((function(e){t[e._id]=0})),a.setState({tickets:e.ticketsData,selectedTickets:t})}}))},a.render=function(){return a.state.selectedTickets?r.a.createElement("div",{className:"ticket-container"},r.a.createElement("div",{className:"ticket-table"},r.a.createElement("table",{className:"ticket-table-details"},r.a.createElement("thead",{className:"ticket-table-header"},r.a.createElement("tr",null,r.a.createElement("td",{className:"ticket-table-td"},"Type"),r.a.createElement("td",{className:"ticket-table-td"},"Discount"),r.a.createElement("td",{className:"ticket-table-td"},"Amount"))),r.a.createElement("tbody",null,a.state.tickets.map((function(e,t){return r.a.createElement("tr",{key:t},r.a.createElement("td",{className:"ticket-table-td"},e.name),r.a.createElement("td",{className:"ticket-table-td"},100-100*e.basePriceRatio),r.a.createElement("td",{className:"ticket-table-td"},r.a.createElement("input",{className:"ticket-input",id:e._id,onChange:a.onTicketValueChanged,type:"number",min:"0",max:"20",value:a.state.selectedTickets[e._id]})))}))))),r.a.createElement("div",{className:"error-text"},a.state.lastError||""),r.a.createElement("div",{className:"ticket-buttons"},r.a.createElement("button",{onClick:a.onNextClick,className:"button"},"Next"))):null},a.state={tickets:[],selectedTickets:{},lastError:""},a}return Object(u.a)(t,e),t}(r.a.Component),N=(a(40),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(m.a)(t).call(this,e))).onPreviousClicked=function(e){a.props.onPreviousClicked&&a.props.onPreviousClicked()},a.onNextClicked=function(e){if(0!==a.state.selectedSeats.length){if(a.props.tickets){var t=a.props.tickets.reduce((function(e,t){return e+Number(t.amount)}),0);if(t!==a.state.selectedSeats.length)return void a.setState({lastError:"You need to select execly ".concat(t," seats.")})}a.props.onSeatsSelected()||a.props.onSeatsSelected(a.state.selectedSeats,a.state.selectedCinemaHall,a.state.repertoires.find((function(e){return e.cinemaHall._id===a.state.selectedCinemaHall.cinemaHall._id})))}else a.setState({lastError:"Before you can continue you need to select seats, by clicking on them."})},a.onSeatClicked=function(e){var t=a.state.selectedCinemaHall.seats.find((function(t){return e.target.id===t._id}));if(t&&!t.reserved){var n=Object(b.a)(a.state.selectedSeats);n.includes(t._id)?n.splice(n.indexOf(t._id),1):(!a.props.tickets||a.props.tickets.reduce((function(e,t){return e+Number(t.amount)}),0)>n.length)&&n.push(t._id),a.setState({selectedSeats:n})}},a.ensureInputIsValid=function(e,t){e.cinemaHallData.seats.forEach((function(e){var a=t.reservedSeatsIds.find((function(t){return t===e._id}));e.reserved=null!==a&&void 0!==a}));var n=[].concat(Object(b.a)(a.state.cinemaHallsData),[e.cinemaHallData]);if(a.state.selectedSeats.length>0&&a.state.selectedCinemaHall&&a.state.selectedCinemaHall.cinemaHall._id===e.cinemaHallData.cinemaHall._id){var r=Object(b.a)(a.state.selectedSeats);if(a.props.tickets)for(var s=r.length-a.props.tickets.reduce((function(e,t){return e+Number(t.amount)}),0),i=0;i<s;i++)r.pop();var l=Object(b.a)(r);r.forEach((function(t){var a=e.cinemaHallData.seats.find((function(e){return t===e._id}));a.reserved&&l.splice(l.indexOf(a._id),1)})),a.setState({selectedSeats:l})}a.setState({cinemaHallsData:n,selectedCinemaHall:a.state.selectedCinemaHall||e.cinemaHallData})},a.fetchReservedSeatsData=function(e,t){fetch("https://cinnemapplication.herokuapp.com/reservation/reservedSeats/"+e.repertoireId).then((function(e){return 200!==e.status?Promise.reject("Service is temporary unavailable."):e.json()})).then((function(e){if("sucess"!==e.status)return Promise.reject("Service is temporary unavailable.");a.ensureInputIsValid(t,e)}))},a.componentDidMount=function(){a.props.repertoires.forEach((function(e){fetch("https://cinnemapplication.herokuapp.com/hall/"+e.cinemaHall._id).then((function(e){return 200!==e.status?Promise.reject("Service is temporary unavailable."):e.json()})).then((function(t){if("sucess"!==t.status)return Promise.reject("Service is temporary unavailable.");a.fetchReservedSeatsData(e,t)}))}))},a.renderSeats=function(){for(var e=[],t=a.state.selectedCinemaHall.seats.reduce((function(e,t){return Number(t.renderingRowNumber)>e?Number(t.renderingRowNumber):e}),0),n=a.state.selectedCinemaHall.seats.reduce((function(e,t){return Number(t.renderingColumnNumber)>e?Number(t.renderingColumnNumber):e}),0),s=function(t){for(var s=function(n){var s=a.state.selectedCinemaHall.seats.find((function(e){return e.renderingRowNumber===t&&e.renderingColumnNumber===n}));if(s){var i="seat-available";s.reserved?i="seat-reserved":a.state.selectedSeats.includes(s._id)&&(i="seat-selected"),e.push(r.a.createElement("div",{className:"seat "+i,key:"row"+t+"col"+n,id:s._id,style:{gridColumnStart:n,gridColumnEnd:n,gridRowStart:t,gridRowEnd:t},onClick:a.onSeatClicked}))}else e.push(r.a.createElement("div",{className:"seat",key:"row"+t+"col"+n,style:{gridColumnStart:n,gridColumnEnd:n,gridRowStart:t,gridRowEnd:t}}))},i=0;i<n;i++)s(i)},i=0;i<t;i++)s(i);return e},a.render=function(){return 0===a.state.cinemaHallsData.length?null:r.a.createElement("div",{className:"cinema-hall-main-container"},r.a.createElement("div",{className:"cinema-hall-screen-container"},r.a.createElement("h1",null,"SCREEN")),r.a.createElement("div",{className:"seats-container"},a.renderSeats()),r.a.createElement("div",{className:"error-text"},a.state.lastError),r.a.createElement("div",{className:"cinema-hall-buttons"},r.a.createElement("button",{className:"button",onClick:a.onPreviousClicked},"Previous"),r.a.createElement("button",{className:"button",onClick:a.onNextClicked},"Next")))},a.state={repertoires:e.repertoires||[],cinemaHallsData:[],selectedCinemaHall:a.props.selectedCinemaHall,selectedSeats:a.props.selectedSeats||[],lastError:""},a}return Object(u.a)(t,e),t}(r.a.Component)),C=(a(41),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(m.a)(t).call(this,e))).onPreviousClicked=function(e){a.props.onPreviousClicked&&a.props.onPreviousClicked()},a.onReserveClicked=function(e){var t=a.state.tickets.filter((function(e){return e.amount>0})),n=[];t.forEach((function(e){for(var t=0;t<e.amount;t++)n.push(e._id)})),console.log("wysylam"),console.log(n);fetch("https://cinnemapplication.herokuapp.com/reservation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:a.name,lastName:a.lastName,email:a.email,phoneNumber:a.phoneNumber,repertoireId:a.state.repertoire.repertoireId,seats:a.state.seats,tickets:n})}).then((function(e){return 200!==e.status&&422!==e.status?Promise.reject("Service is temporary unavailable."):e.json()})).then((function(e){"validationFailed"===e.status?a.setState({errors:e.errors}):a.props.onFinish&&a.props.onFinish()}))},a.onNameChange=function(e){a.name=e.target.value},a.onLastNameChange=function(e){a.lastName=e.target.value},a.onEmailChange=function(e){a.email=e.target.value},a.onPhoneNumberChange=function(e){a.phoneNumber=e.target.value},a.render=function(){var e=a.state.errors.filter((function(e){return"firstName"!==e.param&&"lastName"!==e.param&&"email"!==e.param&&"phoneNumber"!==e.param})).map((function(e){return r.a.createElement("p",{className:"reservation-error-text"},e.msg)})),t=a.state.errors.filter((function(e){return"firstName"===e.param})).map((function(e){return r.a.createElement("p",{className:"reservation-error-text"},e.msg)})),n=a.state.errors.filter((function(e){return"lastName"===e.param})).map((function(e){return r.a.createElement("p",{className:"reservation-error-text"},e.msg)})),s=a.state.errors.filter((function(e){return"phoneNumber"===e.param})).map((function(e){return r.a.createElement("p",{className:"reservation-error-text"},e.msg)})),i=a.state.errors.filter((function(e){return"email"===e.param})).map((function(e){return r.a.createElement("p",{className:"reservation-error-text"},e.msg)}));return r.a.createElement("div",{className:"reservation-container"},r.a.createElement("div",null,e),r.a.createElement("div",{className:"reservation-input-container"},r.a.createElement("label",{htmlFor:"name"},"First name"),r.a.createElement("div",null,r.a.createElement("input",{className:"reservation-input",id:"name",type:"text",onChange:a.onNameChange})),r.a.createElement("div",null,t)),r.a.createElement("div",{className:"reservation-input-container"},r.a.createElement("label",{htmlFor:"surname"},"Last name"),r.a.createElement("div",null,r.a.createElement("input",{className:"reservation-input",id:"surname",type:"text",onChange:a.onLastNameChange})),r.a.createElement("div",null,n)),r.a.createElement("div",{className:"reservation-input-container"},r.a.createElement("label",{htmlFor:"email"},"Email"),r.a.createElement("div",null,r.a.createElement("input",{className:"reservation-input",id:"email",type:"text",onChange:a.onEmailChange})),r.a.createElement("div",null,i)),r.a.createElement("div",{className:"reservation-input-container"},r.a.createElement("label",{htmlFor:"phoneNumber"},"Phone number"),r.a.createElement("div",null,r.a.createElement("input",{className:"reservation-input",id:"phoneNumber",type:"text",onChange:a.onPhoneNumberChange})),r.a.createElement("div",null,s)),r.a.createElement("div",null,r.a.createElement("div",{className:"total-price"},"Total price: ",r.a.createElement("span",null,parseFloat(Math.round(100*a.state.tickets.reduce((function(e,t){return e+=Number(t.basePriceRatio)*Number(a.state.repertoire.baseTicketPrice)*Number(t.amount)}),0))/100).toFixed(2))," z\u0142")),r.a.createElement("div",{className:"reservation-wrapper"},r.a.createElement("button",{className:"button",onClick:a.onPreviousClicked},"Previous"),r.a.createElement("button",{className:"button",onClick:a.onReserveClicked},"Reserve")))},a.state={tickets:a.props.tickets,repertoire:a.props.repertoire,seats:a.props.seats,errors:[]},a}return Object(u.a)(t,e),t}(r.a.Component)),S=(a(42),a(43),a(44),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(o.a)(this,Object(m.a)(t).call(this,e))).reset=function(){a.setState({stage:0}),a.reservationDateTime=0,a.movieToReserve=null,a.repertoiresAvailableToReserve=null,a.selectedTickets=null,a.selectedSeats=null,a.selectedCinemaHall=null,a.selectedRepertoire=null},a.alignCards=function(){if(0!==a.cards.length){for(var e=0;e<a.cards.length;e++)a.cards[e].setMinHeight(0);var t=a.cards.reduce((function(e,t){return t.ref.current.offsetHeight>e?t.ref.current.offsetHeight:e}),0);if(t>0)for(var n=0;n<a.cards.length;n++)a.cards[n].setMinHeight(t)}},a.componentDidMount=function(){window.addEventListener("resize",(function(e){setTimeout((function(){a.alignCards()}),100)})),fetch("https://cinnemapplication.herokuapp.com/repertoire").then((function(e){return 200!==e.status?Promise.reject("Service is temporary unavailable."):e.json()})).then((function(e){if("sucess"!==e.status)return Promise.reject("Service is temporary unavailable.");a.setState({movies:e.movies}),setTimeout((function(){a.alignCards(),a.alignCards()}),200)}))},a.onMakeReservation=function(e,t){a.reservationDateTime=e,a.movieToReserve=t,a.setState({dateTime:e,stage:1})},a.onTicketsSelected=function(e){a.selectedTickets=e,a.repertoiresAvailableToReserve=a.movieToReserve.displayDates.find((function(e){return e.displayDateTime===a.reservationDateTime})).repertoires,a.setState({stage:2})},a.onSeatsSelected=function(e,t,n){a.selectedSeats=e,a.selectedCinemaHall=t,a.selectedRepertoire=n,a.setState({stage:3})},a.onCloseModal=function(){a.reset(),a.setState({stage:0})},a.onPreviousClicked=function(){a.setState({stage:a.state.stage-1})},a.render=function(){return r.a.createElement("div",{className:"main-container"},r.a.createElement(p.a,{dots:!1,infinite:!1,speed:900,slidesToShow:3,slidesToScroll:1,slidesPerRow:1,responsive:[{breakpoint:1500,settings:{slidesToShow:2,slidesToScroll:1}},{breakpoint:1e3,settings:{slidesToShow:1,slidesToScroll:1}}]},a.state.movies.map((function(e,t){return r.a.createElement(h,{key:t,movieData:e,onReserveClicked:a.onMakeReservation,ref:function(e){return a.cards[t]=e}})}))),a.getModal())},a.state={movies:[],stage:0},a.cards=[],a.reset(),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"getModal",value:function(){var e=this;return 1===this.state.stage?r.a.createElement("div",{style:{display:1===this.state.stage?"block":"none"},className:"modal"},r.a.createElement("div",{className:"modal-content modal-content-tickets"},r.a.createElement("div",{className:"close",onClick:function(){return e.onCloseModal()}},"\xd7"),r.a.createElement("h1",{className:"dialog-header"},"Please specify tickets you want to buy"),r.a.createElement("div",{className:"modal-custom-area"},r.a.createElement(g,{selectedTickets:this.selectedTickets,onTicketsSelected:this.onTicketsSelected})))):2===this.state.stage?r.a.createElement("div",{style:{display:2===this.state.stage?"block":"none"},className:"modal"},r.a.createElement("div",{className:"modal-content modal-content-seats"},r.a.createElement("div",{className:"close",onClick:function(){return e.onCloseModal()}},"\xd7"),r.a.createElement("h1",{className:"dialog-header"},"Please select your seats"),r.a.createElement("div",{className:"modal-custom-area"},r.a.createElement(N,{selectedCinemaHall:this.selectedCinemaHall,tickets:this.selectedTickets,selectedSeats:this.selectedSeats,repertoires:this.repertoiresAvailableToReserve,onPreviousClicked:this.onPreviousClicked,onSeatsSelected:this.onSeatsSelected})))):3===this.state.stage?r.a.createElement("div",{style:{display:3===this.state.stage?"block":"none"},className:"modal"},r.a.createElement("div",{className:"modal-content modal-content-reservation"},r.a.createElement("div",{className:"close",onClick:function(){return e.onCloseModal()}},"\xd7"),r.a.createElement("h1",{className:"dialog-header"},"Please insert reservation data"),r.a.createElement("div",{className:"modal-custom-area"},r.a.createElement(C,{tickets:this.selectedTickets,repertoire:this.selectedRepertoire,seats:this.selectedSeats,onPreviousClicked:this.onPreviousClicked,onFinish:this.onCloseModal})))):null}}]),t}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(S,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[17,1,2]]]);
//# sourceMappingURL=main.0da495a4.chunk.js.map